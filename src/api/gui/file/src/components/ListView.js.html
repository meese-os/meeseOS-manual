<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/components/ListView.js | meeseOS GUI API</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
<meta name="description" content="meeseOS GUI API Documentation"><meta property="twitter:card" content="summary"><meta property="twitter:title" content="meeseOS GUI API"><meta property="twitter:description" content="meeseOS GUI API Documentation"></head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/meese-os/meeseOS.git"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/contextmenu.js~ContextMenu.html">ContextMenu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-createField">createField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-doubleTap">doubleTap</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-filteredProps">filteredProps</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#components">components</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Box">Box</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BoxContainer">BoxContainer</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-BoxStyled">BoxStyled</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Button">Button</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Element">Element</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Expander">Expander</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Icon">Icon</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Iframe">Iframe</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Image">Image</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Menu">Menu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Menubar">Menubar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-MenubarItem">MenubarItem</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Progressbar">Progressbar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-RangeField">RangeField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-SelectField">SelectField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Statusbar">Statusbar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-TextareaField">TextareaField</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Toolbar">Toolbar</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-Video">Video</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-BoxProperties">BoxProperties</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-typedef">T</span><span data-ice="name"><span><a href="typedef/index.html#static-typedef-MenuItems">MenuItems</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/components/ListView.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/**
 * OS.js - JavaScript Cloud/Web Desktop Platform
 *
 * Copyright (c) 2011-Present, Anders Evenrud &lt;andersevenrud@gmail.com&gt;
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice, this
 *    list of conditions and the following disclaimer
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * @author  Anders Evenrud &lt;andersevenrud@gmail.com&gt;
 * @licence Simplified BSD License
 */

import { doubleTap, filteredProps } from &quot;../utils&quot;;
import { Element } from &quot;./Element&quot;;
import { Icon } from &quot;./Icon&quot;;
import { h } from &quot;hyperapp&quot;;

const tapper = doubleTap();

const createView = (props) =&gt; {
	let debounceScroll;

	const cols = (paneIndex) =&gt; (row, rowIndex) =&gt; {
		const col = row.columns[paneIndex] || {};
		const colIcon = col.icon ? h(Icon, col.icon) : null;
		const children = [
			h(&quot;span&quot;, {}, [typeof col === &quot;object&quot; ? col.label : col]),
		];
		const selected = props.multiselect
			? props.selectedIndex.indexOf(rowIndex) !== -1
			: props.selectedIndex === rowIndex;

		if (colIcon) {
			children.unshift(colIcon);
		}

		return h(
			&quot;div&quot;,
			{
				key: row.key,
				&quot;data-has-icon&quot;: col.icon ? true : undefined,
				class:
					&quot;meeseOS-gui-list-view-cell&quot; + (selected ? &quot; meeseOS__active&quot; : &quot;&quot;),
				ontouchstart: (ev) =&gt;
					tapper(ev, () =&gt;
						props.onactivate({ index: rowIndex, ev })
					),
				ondblclick: (ev) =&gt; props.onactivate({ index: rowIndex, ev }),
				onclick: (ev) =&gt; props.onselect({ index: rowIndex, ev }),
				oncontextmenu: (ev) =&gt; props.oncontextmenu({ index: rowIndex, ev }),
				oncreate: (el) =&gt; props.oncreate({ index: rowIndex, el }),
			},
			children
		);
	};

	// TODO: Allow horizontal resizing here
	// IDEA: https://stackoverflow.com/a/53220241/6456163
	// or https://stackoverflow.com/a/63195505/6456163
	// or https://stackoverflow.com/a/33523184/6456163
	const pane = (index, col) =&gt; h(
		&quot;div&quot;,
		{
			class: &quot;meeseOS-gui-list-view-pane&quot;,
			style: col.style || {},
		},
		[
			h(
				&quot;div&quot;,
				{
					class: &quot;meeseOS-gui-list-view-header&quot;,
					style: {
						display: props.hideColumns ? &quot;none&quot; : undefined,
					},
				},
				h(&quot;span&quot;, {}, typeof col === &quot;object&quot; ? col.label : col)
			),
			h(
				&quot;div&quot;,
				{
					class: &quot;rows&quot;,
					&quot;data-zebra&quot;: String(props.zebra),
				},
				props.rows.map(cols(index))
			),
		]
	);

	return h(
		&quot;div&quot;,
		{
			// TODO: Allow clicking the column name to sort by that column
			class: &quot;meeseOS-gui-list-view-wrapper&quot;,
			onscroll: (ev) =&gt; {
				debounceScroll = clearTimeout(debounceScroll);
				debounceScroll = setTimeout(() =&gt; {
					props.onscroll(ev);
				}, 100);
			},
			oncreate: (el) =&gt; (el.scrollTop = props.scrollTop),
			onupdate: (el) =&gt; {
				const notSelected = props.multiselect
					? props.selectedIndex.length === 0
					: props.selectedIndex &lt; 0;

				if (notSelected) {
					el.scrollTop = props.scrollTop;
				}
			},
		},
		props.columns.map((col, index) =&gt; pane(index, col))
	);
};

export const ListView = (props) =&gt; h(
	Element,
	{
		class: &quot;meeseOS-gui-list-view&quot;,
		...props.box || {}
	},
	createView(filteredProps(props, [&quot;box&quot;]))
);

export const listView = {
	component: (state, actions) =&gt; {
		const createSelection = (index) =&gt; {
			if (!state.multiselect) return state.selectedIndex;

			const foundIndex = state.selectedIndex.indexOf(index);
			const newSelection = [...state.selectedIndex];
			if (foundIndex === -1) {
				newSelection.push(index);
			} else {
				newSelection.splice(foundIndex, 1);
			}

			return newSelection;
		};

		/**
		 * Creates a range of indexes from start to end.
		 * @param {Number} start
		 * @param {Number} end
		 * @returns {Array}
		 */
		const createSelectionRange = (start, end) =&gt; {
			// Swaps start and end if start is greater than end
			if (start &gt; end) [start, end] = [end, start];

			const indices = [
				...state.selectedIndex,
				// Generates a range of indexes from start to end
				...Array.from({ length: end - start + 1 }, (_, i) =&gt; i + start)
			];

			// Remove duplicates from the array
			return [...new Set(indices)];
		};

		/**
		 * Creates an updated selection based on the user&apos;s most recent selection.
		 * &apos;ctrl&apos; and &apos;shift&apos; keys are used to create a range of indexes.
		 * @param {Number} index The index to add to the selection
		 * @param {Object} ev The event object
		 * @returns {Object}
		 */
		const getSelection = (index, ev) =&gt; {
			const selected = state.multiselect
				? (ev.shiftKey
					? createSelectionRange(state.previousSelectedIndex, index)
					: ev.ctrlKey
						? createSelection(index)
						: [index])
				: index;

			const data = state.multiselect
				? selected.map((item) =&gt; state.rows[item].data)
				: state.rows[selected].data;

			// Store the previous index in the state to use for calculating the
			// range if the shift key is pressed
			if (state.multiselect) actions.setPreviousSelectedIndex(index);
			return { selected, data };
		};

		const clearCurrentSelection = (index) =&gt; {
			const selected = state.multiselect ? [] : -1;

			const data = state.multiselect
				? state.selectedIndex.map((item) =&gt; state.rows[item].data)
				: state.rows[index].data;

			return { selected, data };
		};

		const newProps = {
			multiselect: false,
			zebra: true,
			columns: [],
			rows: [],
			onselect: ({ index, ev }) =&gt; {
				const { selected, data } = getSelection(index, ev);
				actions.select({ data, index, ev, selected });
				actions.setSelectedIndex(selected);
			},
			onactivate: ({ index, ev }) =&gt; {
				const { selected, data } = clearCurrentSelection(index);
				actions.activate({ data, index, ev, selected });
				actions.setSelectedIndex(selected);
			},
			oncontextmenu: ({ index, ev }) =&gt; {
				const { selected, data } = getSelection(index, ev);

				actions.select({ data, index, ev });
				actions.contextmenu({ data, index, ev, selected });
				actions.setSelectedIndex(selected);
			},
			oncreate: ({ index, el }) =&gt; {
				const data = state.rows[index].data;
				actions.created({ index, el, data });
			},
			onscroll: (ev) =&gt; {
				actions.scroll(ev);
			},
			...state
		};

		return (props = {}) =&gt; ListView(Object.assign(newProps, props));
	},

	state: (state) =&gt; ({
		selectedIndex: state.multiselect ? [] : -1,
		scrollTop: 0,
		...state
	}),

	actions: (actions) =&gt; ({
		select: () =&gt; () =&gt; ({}),
		activate: () =&gt; () =&gt; ({}),
		contextmenu: () =&gt; () =&gt; ({}),
		created: () =&gt; () =&gt; ({}),
		scroll: () =&gt; (state) =&gt; state,
		setRows: (rows) =&gt; ({ rows }),
		setColumns: (columns) =&gt; ({ columns }),
		setScrollTop: (scrollTop) =&gt; ({ scrollTop }),
		setSelectedIndex: (selectedIndex) =&gt; ({ selectedIndex }),
		setPreviousSelectedIndex: (previousSelectedIndex) =&gt; ({ previousSelectedIndex }),
		...actions || {}
	}),
};
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
